generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Plan {
  BASIC
  PRO
  PREMIUM
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  name          String
  plan          Plan           @default(BASIC)
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  organizations Organization[]

  @@map("users")
}

model Organization {
  id        String       @id @default(uuid())
  name      String
  ownerId   String       @map("owner_id")
  createdAt DateTime     @default(now()) @map("created_at")
  owner     User         @relation(fields: [ownerId], references: [id])
  projects  Project[]
  events    TraceEvent[]

  @@map("organizations")
}

model Project {
  id           String       @id @default(uuid())
  orgId        String       @map("org_id")
  name         String
  createdAt    DateTime     @default(now()) @map("created_at")
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  events       TraceEvent[]

  @@index([orgId])
  @@map("projects")
}

model TraceEvent {
  id           String       @id @default(uuid())
  orgId        String       @map("org_id")
  projectId    String       @map("project_id")
  serviceName  String       @map("service_name")
  endpoint     String
  method       String
  status       Int
  latencyMs    Int          @map("latency_ms")
  responseSize Int?         @map("response_size")
  traceId      String       @map("trace_id")
  tags         Json?
  timestamp    DateTime
  createdAt    DateTime     @default(now()) @map("created_at")
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  project      Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([orgId])
  @@index([projectId])
  @@index([traceId])
  @@index([timestamp])
  @@map("trace_events")
}
